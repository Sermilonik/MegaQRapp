<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR –°–∫–∞–Ω–µ—Ä –°–∫–ª–∞–¥–∞</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <a href="index.html" class="back-button">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <h1>üì¶ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–æ–≤</h1>
            <p class="subtitle">–°–∫–ª–∞–¥—Å–∫–æ–π –º–æ–¥—É–ª—å</p>
        </header>

        <!-- –í–´–ë–û–† –ö–û–ù–¢–†–ê–ì–ï–ù–¢–û–í -->
        <div class="card">
            <h3>1. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤</h3>
        
            <div class="contractor-search-container">
                <div class="contractor-search">
                    <input type="text" id="contractorSearch" placeholder="üîç –ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞..." 
                           class="form-select" autocomplete="off">
                    <div id="contractorDropdown" class="contractor-dropdown hidden"></div>
                </div>
            </div>
        
            <!-- –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
            <div class="contractor-management-buttons">
                <button class="btn btn-outline btn-sm" id="addManualContractorBtn">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
                </button>
                <button class="btn btn-outline btn-sm" id="importContractorsBtn">
                    üì• –ò–º–ø–æ—Ä—Ç –∏–∑ CSV
                </button>
                <button class="btn btn-outline btn-sm" id="showContractorManagerBtn">
                    üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏
                </button>
            </div>
        
            <div id="selectedContractors" class="selected-contractors hidden">
                <div class="selected-header">
                    <span>–í—ã–±—Ä–∞–Ω–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤: <strong id="selectedCount">0</strong></span>
                    <button class="btn btn-sm btn-outline" id="clearContractors">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                    </button>
                </div>
                <div id="contractorsList" class="contractors-list">
                    <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <!-- –°–¢–ê–¢–£–° –°–ï–°–°–ò–ò -->
        <div id="sessionStatus" class="card status-card hidden">
            <div class="status-header">
                <span id="statusIcon">‚è≥</span>
                <h3 id="statusTitle">–°–µ—Å—Å–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            </div>
            <div class="status-info">
                <div class="status-item">
                    <span class="label">–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã:</span>
                    <span id="currentContractor">-</span>
                </div>
                <div class="status-item">
                    <span class="label">–û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫–æ–¥–æ–≤:</span>
                    <span id="codesCount" class="badge">0</span>
                </div>
            </div>
        </div>

        <!-- –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï -->
        <div class="card">
            <h3>2. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–æ–≤</h3>
            
            <div class="scan-controls">
                <button id="startCamera" class="btn btn-primary" disabled>
                    <span class="btn-icon">üì∑</span>
                    –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É
                </button>
                <button id="stopCamera" class="btn btn-secondary hidden">
                    <span class="btn-icon">‚èπÔ∏è</span>
                    –í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É
                </button>
                <button id="showSimulator" class="btn btn-outline">
                    <span class="btn-icon">üß™</span>
                    –°–∏–º—É–ª—è—Ç–æ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                </button>
            </div>

            <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –°–ö–ê–ù–ï–†–ê -->
            <div id="scannerContainer" class="scanner-container">
                <div id="reader" class="scanner-placeholder">
                    <div class="scanner-overlay">
                        <span class="placeholder-icon">üì∑</span>
                        <p>–ö–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞</p>
                        <div class="scanner-frame"></div>
                    </div>
                </div>
            </div>

            <!-- –°–ò–ú–£–õ–Ø–¢–û–† -->
            <div id="simulator" class="simulator hidden">
                <h4>üß™ –¢–µ—Å—Ç–æ–≤—ã–µ QR-–∫–æ–¥—ã</h4>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –∫–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</p>
                
                <div class="test-codes-grid">
                    <div class="test-code" data-scan="0104604063405720219NQNfSwVmcTEST001">
                        <span class="code-preview">0104604063405720219NQNfSwVmcTEST001</span>
                        <button class="btn btn-sm btn-success">üì¶ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <div class="test-code" data-scan="0104604063405720219NQNfSwVmdTEST002">
                        <span class="code-preview">0104604063405720219NQNfSwVmdTEST002</span>
                        <button class="btn btn-sm btn-success">üì¶ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <div class="test-code" data-scan="0104604063405720219NQNfSwVmeTEST003">
                        <span class="code-preview">0104604063405720219NQNfSwVmeTEST003</span>
                        <button class="btn btn-sm btn-success">üì¶ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–ü–ò–°–û–ö –ö–û–î–û–í -->
        <div class="card">
            <div class="card-header">
                <h3>3. –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã</h3>
                <span id="totalCodes" class="badge">0</span>
            </div>
            
            <div id="codesList" class="codes-list">
                <div class="empty-state">
                    <span class="empty-icon">üì¶</span>
                    <p>–ù–µ—Ç –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤</p>
                    <small>–ù–∞—á–Ω–∏—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–º—É–ª—è—Ç–æ—Ä</small>
                </div>
            </div>
        </div>

        <!-- –î–ï–ô–°–¢–í–ò–Ø -->
        <div class="card">
            <h3>4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h3>
            <div class="actions-grid">
                <button id="generateReport" class="btn btn-success" disabled>
                    <span class="btn-icon">üìÑ</span>
                    –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç PDF
                </button>
                <button id="clearSession" class="btn btn-danger">
                    <span class="btn-icon">üóëÔ∏è</span>
                    –û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é
                </button>
            </div>
        </div>

        <!-- –ò–°–¢–û–†–ò–Ø –û–¢–ß–ï–¢–û–í -->
        <div class="card">
            <div class="card-header">
                <h3>üìä –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤</h3>
            </div>
        
            <div id="reportsList" class="reports-list">
                <div class="empty-state">
                    <span class="empty-icon">üìÑ</span>
                    <p>–ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</p>
                    <small>–°–æ–∑–¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö -->
    <div class="card">
        <div class="card-header">
            <h3>‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</h3>
            <span id="syncStatus" class="badge badge-warning">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        
        <div class="sync-actions">
            <button class="btn btn-outline" onclick="scannerManager.exportData()">
                üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª
            </button>
            <button class="btn btn-outline" onclick="scannerManager.importData()">
                üì• –ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞
            </button>
            <button class="btn btn-success" onclick="scannerManager.forceSync()" id="forceSyncBtn">
                üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="btn btn-info" onclick="scannerManager.toggleSync()" id="toggleSyncBtn">
                ‚ö° –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            </button>
            <button class="btn btn-warning" onclick="forceDataAlignment()" id="forceAlignBtn">
            üéØ –í—ã—Ä–æ–≤–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button
        </div>
        
        <div id="syncInfo" style="margin-top: 15px; font-size: 12px; color: #666;">
            <div>üì± Firebase —Å—Ç–∞—Ç—É—Å: <span id="firebaseStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></div>
            <div>üë§ ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: <span id="deviceId">-</span></div>
            <div>üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: <span id="autoSyncStatus">-</span></div>
            <div>üïê –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: <span id="lastSync">-</span></div>
        </div>
    </div>
    
    <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô -->
    <div id="notificationContainer"></div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–û–ù–¢–†–ê–ì–ï–ù–¢–ê–ú–ò -->
    <div id="contractorManager" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏</h3>
                <button class="btn btn-sm btn-secondary" id="hideContractorManager">
                    ‚úï –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
            
            <div class="modal-body">
                <div class="quick-actions">
                    <button class="btn btn-success" id="showAddContractorFormBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</button>
                    <button class="btn btn-outline" id="showImportFormBtn">üì• –ò–º–ø–æ—Ä—Ç –∏–∑ CSV</button>
                </div>
                
                <!-- –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ö–û–ù–¢–†–ê–ì–ï–ù–¢–ê -->
                <div id="addContractorForm" class="form-section hidden">
                    <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</h4>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="contractorName" class="form-select" placeholder="–û–û–û –†–æ–º–∞—à–∫–∞">
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                        <input type="text" id="contractorCategory" class="form-select" placeholder="–û–ø—Ç–æ–≤—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="addContractor">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
                        <button class="btn btn-outline" id="hideAddContractorForm">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
                
                <!-- –§–û–†–ú–ê –ò–ú–ü–û–†–¢–ê -->
                <div id="importForm" class="form-section hidden">
                    <h4>–ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤</h4>
                    <div class="form-group">
                        <label>CSV –¥–∞–Ω–Ω—ã–µ (–ù–∞–∑–≤–∞–Ω–∏–µ,–ö–∞—Ç–µ–≥–æ—Ä–∏—è):</label>
                        <textarea id="importData" class="form-select" rows="6" placeholder="–û–û–û –†–æ–º–∞—à–∫–∞,–û–ø—Ç–æ–≤—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
–ò–ü –ò–≤–∞–Ω–æ–≤,–†–æ–∑–Ω–∏—á–Ω–∞—è —Å–µ—Ç—å
–û–û–û –õ—É—á,–î–∏–ª–µ—Ä"></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="importContractors">üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-outline" id="hideImportForm">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
                
                <!-- –°–ü–ò–°–û–ö –ö–û–ù–¢–†–ê–ì–ï–ù–¢–û–í -->
                <div class="contractors-list-section">
                    <h4>–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤</h4>
                    <div class="search-box">
                        <input type="text" id="managerSearch" placeholder="üîç –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤..." class="form-select">
                    </div>
                    <div id="contractorsManagerList" class="contractors-manager-list">
                        <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–û–ë–ò–õ–¨–ù–ê–Ø –ö–û–ù–°–û–õ–¨ –î–õ–Ø –û–¢–õ–ê–î–ö–ò -->
    <div id="mobileConsole" style="position: fixed; bottom: 10px; right: 10px; z-index: 10000;">
        <button onclick="toggleMobileConsole()" style="background: #007bff; color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 20px;">
            üêõ
        </button>
        <div id="consolePanel" style="display: none; position: absolute; bottom: 60px; right: 0; width: 320px; height: 300px; background: #1e1e1e; color: #00ff00; border: 2px solid #007bff; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px;">
            <div style="background: #007bff; color: white; padding: 8px; border-radius: 6px 6px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <strong>–ö–æ–Ω—Å–æ–ª—å –æ—Ç–ª–∞–¥–∫–∏</strong>
                <div>
                    <button onclick="clearMobileConsole()" style="background: #ff4444; color: white; border: none; border-radius: 4px; padding: 2px 8px; margin-right: 5px;">üßπ</button>
                    <button onclick="toggleMobileConsole()" style="background: #666; color: white; border: none; border-radius: 4px; padding: 2px 8px;">‚úï</button>
                </div>
            </div>
            <div id="consoleOutput" style="height: 220px; overflow-y: auto; padding: 10px; border-bottom: 1px solid #333;">
                <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
            <div style="padding: 8px;">
                <input type="text" id="consoleInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É..." 
                       style="width: 100%; padding: 8px; border: 1px solid #555; background: #2d2d2d; color: #00ff00; border-radius: 4px; font-family: monospace;"
                       onkeypress="handleConsoleInput(event)">
                <small style="color: #888; display: block; margin-top: 5px;">
                    –ö–æ–º–∞–Ω–¥—ã: debug, contractors, camera, help
                </small>
            </div>
        </div>
    </div>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- Firebase Configuration -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-sync.js"></script>
    <script src="js/firebase-sync.js?v=1.1"></script>

    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –°–ö–†–ò–ü–¢–´ -->
    <script src="js/app-state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/pdf-generator.js"></script>
    <script src="js/scanner.js"></script>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bwip-js@3.11.0/dist/bwip-js.min.js"></script>

    <script>
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–õ–ê–î–ö–ò
        function toggleMobileConsole() {
            const panel = document.getElementById('consolePanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // –ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –∫–ª–∞—Å—Å AppState
        console.log('AppState class:', typeof AppState);
        console.log('appState instance:', window.appState);

        // –ï—Å–ª–∏ –∫–ª–∞—Å—Å –¥–æ—Å—Ç—É–ø–µ–Ω, —Å–æ–∑–¥–∞–¥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä
        if (typeof AppState !== 'undefined' && !window.appState) {
            console.log('üîÑ –°–æ–∑–¥–∞–µ–º AppState...');
            window.appState = new AppState();
            console.log('‚úÖ AppState —Å–æ–∑–¥–∞–Ω:', window.appState);
        }

        function clearMobileConsole() {
            document.getElementById('consoleOutput').innerHTML = '';
        }

        function handleConsoleInput(event) {
            if (event.key === 'Enter') {
                const command = event.target.value.trim();
                event.target.value = '';
                executeConsoleCommand(command);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function forceSyncAll() {
        console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö...');
        
        // 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ localStorage
        const contractors = JSON.parse(localStorage.getItem('honest_sign_contractors') || '[]');
        console.log('üìä –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã:', contractors.length);
        
        // 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase —á–µ—Ä–µ–∑ AppState
        if (window.appState && window.appState.syncWithFirebase) {
            window.appState.syncWithFirebase()
                .then(result => {
                    console.log('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:', result.length, '–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤');
                })
                .catch(error => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                });
        } else {
            console.error('‚ùå AppState –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
        }
    }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
        forceSyncAll();

        function executeConsoleCommand(command) {
            const output = document.getElementById('consoleOutput');
            
            function addLog(message) {
                output.innerHTML += `<div style="margin-bottom: 5px;">${message}</div>`;
                output.scrollTop = output.scrollHeight;
            }

            addLog(`<span style="color: #ffff00">&gt; ${command}</span>`);

            switch(command.toLowerCase()) {
                case 'debug':
                    addLog('<strong>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</strong>');
                    addLog(`‚Ä¢ ScannerManager: ${window.scannerManager ? '‚úÖ' : '‚ùå'}`);
                    addLog(`‚Ä¢ AppState: ${window.appState ? '‚úÖ' : '‚ùå'}`);
                    if (window.scannerManager) {
                        addLog(`‚Ä¢ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤: ${scannerManager.allContractors.length}`);
                        addLog(`‚Ä¢ –í—ã–±—Ä–∞–Ω–æ: ${scannerManager.selectedContractors.length}`);
                        addLog(`‚Ä¢ –ö–∞–º–µ—Ä–∞: ${scannerManager.isScanning ? '‚úÖ' : '‚ùå'}`);
                    }
                    break;
                    
                case 'contractors':
                    if (window.scannerManager) {
                        addLog('<strong>üë• –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã:</strong>');
                        scannerManager.allContractors.forEach(c => {
                            addLog(`‚Ä¢ ${c.name} (${c.category})`);
                        });
                    } else {
                        addLog('‚ùå ScannerManager –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                    break;
                    
                case 'camera':
                    addLog('<strong>üì∑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–º–µ—Ä—ã:</strong>');
                    if (navigator.mediaDevices) {
                        navigator.mediaDevices.enumerateDevices()
                            .then(devices => {
                                const cameras = devices.filter(d => d.kind === 'videoinput');
                                addLog(`‚Ä¢ –ù–∞–π–¥–µ–Ω–æ –∫–∞–º–µ—Ä: ${cameras.length}`);
                                cameras.forEach((cam, i) => {
                                    addLog(`  ${i+1}. ${cam.label || '–ö–∞–º–µ—Ä–∞ ' + (i+1)}`);
                                });
                            })
                            .catch(error => {
                                addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                            });
                    } else {
                        addLog('‚ùå mediaDevices –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    }
                    break;
                    
                case 'help':
                    addLog('<strong>üìã –ö–æ–º–∞–Ω–¥—ã:</strong>');
                    addLog('‚Ä¢ <strong>debug</strong> - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã');
                    addLog('‚Ä¢ <strong>contractors</strong> - —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤');
                    addLog('‚Ä¢ <strong>camera</strong> - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–º–µ—Ä—ã');
                    addLog('‚Ä¢ <strong>clear</strong> - –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å');
                    addLog('‚Ä¢ <strong>help</strong> - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞');
                    break;
                    
                case 'clear':
                    clearMobileConsole();
                    break;
                    
                default:
                    if (command) {
                        addLog(`‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: "${command}"`);
                    }
            }
        }

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–æ–±–∏–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            const output = document.getElementById('consoleOutput');
            if (output) {
                output.innerHTML += `<div style="color: #00ff00; margin-bottom: 3px;">${message}</div>`;
                output.scrollTop = output.scrollHeight;
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É ScannerManager
            setTimeout(() => {
                if (!window.scannerManager) {
                    console.error('‚ùå ScannerManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                } else {
                    console.log('‚úÖ ScannerManager –≥–æ—Ç–æ–≤');
                }
            }, 1000);
        });
    </script>
</body>
</html>
